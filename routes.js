(function () {
'use strict';

var Messenger=class{constructor(a){this.router=a,this._listen();}_listen(){self.addEventListener('message',a=>this.handle(a));}handle(a){let b=a.data;switch(b.type){case'initial':this.router.baseURI=b.baseURI;var d={method:'GET',url:b.url};b.state&&(this.router.state=b.state),this.router.dispatch(d);break;case'request':this.router.dispatch(b);}}send(a){postMessage({tree:a});}};
var index$1=Array.isArray||function(a){return'[object Array]'==Object.prototype.toString.call(a)};
var isarray=index$1;
var index=pathToRegexp;
var parse_1=parse;
var compile_1=compile;
var tokensToFunction_1=tokensToFunction;
var tokensToRegExp_1=tokensToRegExp;
var PATH_REGEXP=new RegExp(['(\\\\.)','([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?|(\\*))'].join('|'),'g');function parse(a,b){for(var p,d=[],f=0,g=0,k='',l=b&&b.delimiter||'/';null!=(p=PATH_REGEXP.exec(a));){var q=p[0],r=p[1],t=p.index;if(k+=a.slice(g,t),g=t+q.length,r){k+=r[1];continue}var u=a[g],v=p[2],w=p[3],x=p[4],y=p[5],z=p[6],A=p[7];k&&(d.push(k),k='');var B=p[2]||l,C=x||y;d.push({name:w||f++,prefix:v||'',delimiter:B,optional:'?'===z||'*'===z,repeat:'+'===z||'*'===z,partial:null!=v&&null!=u&&u!==v,asterisk:!!A,pattern:C?escapeGroup(C):A?'.*':'[^'+escapeString(B)+']+?'});}return g<a.length&&(k+=a.substr(g)),k&&d.push(k),d}function compile(a,b){return tokensToFunction(parse(a,b))}function encodeURIComponentPretty(a){return encodeURI(a).replace(/[\/?#]/g,function(b){return'%'+b.charCodeAt(0).toString(16).toUpperCase()})}function encodeAsterisk(a){return encodeURI(a).replace(/[?#]/g,function(b){return'%'+b.charCodeAt(0).toString(16).toUpperCase()})}function tokensToFunction(a){var b=Array(a.length);for(var d=0;d<a.length;d++)'object'==typeof a[d]&&(b[d]=new RegExp('^(?:'+a[d].pattern+')$'));return function(f,g){var k='',l=f||{},p=(g||{}).pretty?encodeURIComponentPretty:encodeURIComponent;for(var q=0;q<a.length;q++){var r=a[q];if('string'==typeof r){k+=r;continue}var u,t=l[r.name];if(null==t)if(r.optional){r.partial&&(k+=r.prefix);continue}else throw new TypeError('Expected "'+r.name+'" to be defined');if(isarray(t)){if(!r.repeat)throw new TypeError('Expected "'+r.name+'" to not repeat, but received `'+JSON.stringify(t)+'`');if(0===t.length)if(r.optional)continue;else throw new TypeError('Expected "'+r.name+'" to not be empty');for(var v=0;v<t.length;v++){if(u=p(t[v]),!b[q].test(u))throw new TypeError('Expected all "'+r.name+'" to match "'+r.pattern+'", but received `'+JSON.stringify(u)+'`');k+=(0===v?r.prefix:r.delimiter)+u;}continue}if(u=r.asterisk?encodeAsterisk(t):p(t),!b[q].test(u))throw new TypeError('Expected "'+r.name+'" to match "'+r.pattern+'", but received "'+u+'"');k+=r.prefix+u;}return k}}function escapeString(a){return a.replace(/([.+*?=^!:${}()[\]|\/\\])/g,'\\$1')}function escapeGroup(a){return a.replace(/([=!:$\/()])/g,'\\$1')}function attachKeys(a,b){return a.keys=b,a}function flags(a){return a.sensitive?'':'i'}function regexpToRegexp(a,b){var d=a.source.match(/\((?!\?)/g);if(d)for(var f=0;f<d.length;f++)b.push({name:f,prefix:null,delimiter:null,optional:!1,repeat:!1,partial:!1,asterisk:!1,pattern:null});return attachKeys(a,b)}function arrayToRegexp(a,b,d){var f=[];for(var g=0;g<a.length;g++)f.push(pathToRegexp(a[g],b,d).source);var k=new RegExp('(?:'+f.join('|')+')',flags(d));return attachKeys(k,b)}function stringToRegexp(a,b,d){return tokensToRegExp(parse(a,d),b,d)}function tokensToRegExp(a,b,d){isarray(b)||(d=b||d,b=[]),d=d||{};var f=d.strict,g=!1!==d.end,k='';for(var l=0;l<a.length;l++){var p=a[l];if('string'==typeof p)k+=escapeString(p);else{var q=escapeString(p.prefix),r='(?:'+p.pattern+')';b.push(p),p.repeat&&(r+='(?:'+q+r+')*'),r=p.optional?p.partial?q+'('+r+')?':'(?:'+q+'('+r+'))?':q+'('+r+')',k+=r;}}var t=escapeString(d.delimiter||'/'),u=k.slice(-t.length)===t;return f||(k=(u?k.slice(0,-t.length):k)+'(?:'+t+'(?=$))?'),k+=g?'$':f&&u?'':'(?='+t+'|$)',attachKeys(new RegExp('^'+k,flags(d)),b)}function pathToRegexp(a,b,d){return isarray(b)||(d=b||d,b=[]),d=d||{},a instanceof RegExp?regexpToRegexp(a,b):isarray(a)?arrayToRegexp(a,b,d):stringToRegexp(a,b,d)}index.parse=parse_1,index.compile=compile_1,index.tokensToFunction=tokensToFunction_1,index.tokensToRegExp=tokensToRegExp_1;function decodeURLEncodedURIComponent(a){return'string'==typeof a?decodeURIComponent(a.replace(/\+/g,' ')):a}class Route{constructor(a,b){b=b||{},this.path='*'===a?'(.*)':a,this.method=b.method===void 0?'GET':b.method,this.regexp=index(this.path,this.keys=[]);}isMatch(a,b){if(this.method!==a)return!1;var d=b.indexOf('?'),f=~d?b.slice(0,d):b,g=this.regexp.exec(decodeURIComponent(f));return g}match(a,b,d){let f=this.isMatch(a,b);if(!f)return!1;var g=this.keys;for(var k=1,l=f.length;k<l;++k){var p=g[k-1],q=decodeURLEncodedURIComponent(f[k]);q===void 0&&hasOwnProperty.call(d,p.name)||(d[p.name]=q);}return!0}middleware(a){return(b,d,f)=>{return this.match(b.method,b.url.pathname,b.params)?a(b,d,f):void f()}}}var Response=class{constructor(a,b){this.request=a,this.app=b,this.messenger=b.messenger,this.isEnded=!1;}redirect(a){this.app.handle({method:'GET',url:a});}push(a){'html'===a[0][1]&&a.shift(),'html'===a[a.length-1][1]&&a.pop(),this.messenger.send(a);}end(a){this.isEnded||(this.push(a),this.isEnded=!0);}};class App{static get app(){return this._val}static set app(a){this._app=a;}static hasMatchingRoute(a,b){return this._app.hasMatchingRoute(a,b)}constructor(){this.messenger=new Messenger(this),this.baseURI='/',this.routes=[],this.callbacks=[],this.state={},App.app=this;}dispatch(a){function b(){let k=g.callbacks[f++];k&&k(a,d,b);}a.url=new URL(a.url),a.params={};let d=new Response(a,this),f=0,g=this;b();}hasMatchingRoute(a,b){for(var d=0,f=this.routes.length;d<f;d++)if(this.routes[d].isMatch(a,b))return!0;return!1}_addRoute(a,b,d){if(d.length){var f=new Route(b,{method:a});for(var g=0;g<d.length;++g)this.callbacks.push(f.middleware(d[g]));this.routes.push(f);}}configure(a){return a.call(this),this}use(a,...b){return this._addRoute(null,a||'*',b),this}get(a,...b){this._addRoute('GET',a,b);}post(a,...b){this._addRoute('POST',path,b);}}const isNode='object'==typeof process&&'[object process]'==={}.toString.call(process);function signal(a,b,d,f){switch(b){case'action':if('form'===a){let g=s.event(f)||'submit',k=s.method(f)||f.method;return[1,'on'+g,d,k]}break;case'href':if('a'===a&&App.hasMatchingRoute('GET',d))return[1,'onclick',d,'GET'];}}const s=['event','url','method'].reduce(function(a,b){return a[b]=function(d){return d['data-'+b]},a},{});var signal$1=isNode?function(){}:signal;class Tree extends Array{}var h=function(a,b,d){const f=arguments.length;if(2===f?('object'!=typeof b||Array.isArray(b))&&(d=b,b=null):(3<f||d instanceof Tree||'string'==typeof d)&&(d=Array.prototype.slice.call(arguments,2)),'function'==typeof a)return a(b||{},d);var g=new Tree;if(b){var k;b=Object.keys(b).reduce(function(p,q){var r=b[q];p.push(q),p.push(r);var t=signal$1(a,q,r,b);return t&&(!k&&(k=[]),k.push(t)),p},[]);}var l=[1,a];return b&&l.push(b),k&&l.push(k),g.push(l),d&&d.forEach(function(p){if('string'==typeof p)return void g.push([4,p]);for(;p&&p.length;)g.push(p.shift());}),g.push([2,a]),g};function fritz(){return new App}fritz.h=h;

const isNode$1='object'==typeof process&&'[object process]'==={}.toString.call(process);var Layout = function(a,b){let c=a.state;const d=isNode$1?h('div',null,h('script',{src:'/node_modules/fritz/window.js'}),h('script',null,c?`fritz.state = ${JSON.stringify(c)};\n`:'','fritz.router = new Worker(\'/routes.js\');')):'';return h('html',null,h('head',null,h('title',null,'Aliens app!'),h('link',{rel:'stylesheet',href:'/styles.css'}),h('meta',{name:'viewport',content:'width=device-width, initial-scale=1'})),h('body',null,h('header',null),h('main',null,h('section',null,b)),h('footer',null,h('p',null,'Content courtesy of the ',h('a',{href:'http://avp.wikia.com/wiki/Main_Page'},'Xenopedia'),', and licensed under the ',h('a',{href:'http://www.wikia.com/Licensing'},'CC-BY-SA'),'.')),d))};

function Specie({specie:a}){let b=`/article/${a.id}`;return h("li",{"class":"specie"},h("a",{href:b},h("figure",null,h("img",{src:a.thumbnail})),h("span",{"class":"specie-title"},a.title)))}var SpeciesList = function({filter:a,species:b}){let c=a?filterSpecies(b,a):b;return h("div",null,h("h1",null,"Aliens"),h("form",{action:"/search","data-event":"keyup","data-no-push":!0},h("input",{type:"text",value:a?a:"",name:"q",placeholder:"Search species","class":"alien-search"})),h("ul",{"class":"species"},c.map(d=>{return h(Specie,{specie:d})})))};function filterSpecies(a,b){return b=b.toLowerCase(),a.filter(c=>0===c.title.toLowerCase().indexOf(b))}

function details(a){return fetch(`/api/details/${a.join(',')}`).then(b=>b.json()).then(b=>{let c=Object.keys(b.items).map(d=>b.items[d]);return c})}function article(a){return fetch(`/api/article/${a}`).then(b=>b.json())}

const ids=[1443,8459,1758,1754,11254];var indexRoute = function(){function a(c,d,e){return b.state.species?void e():void details(ids).then(f=>{b.state.species=f,e();})}const b=this;b.get('/',a,function(c,d){let e=b.state.species;d.push(h(Layout,null,h(SpeciesList,{species:e})));}),b.get('/search',a,function(c,d){let e=c.url.searchParams.get('q'),f=b.state.species;d.push(h(Layout,null,h(SpeciesList,{species:f,filter:e})));});};

const isNode$2='object'==typeof process&&'[object process]'==={}.toString.call(process);var Layout$1 = function(a,b){let c=a.state;const d=isNode$2?h('div',null,h('script',{src:'/node_modules/fritz/window.js'}),h('script',null,c?`fritz.state = ${JSON.stringify(c)};\n`:'','fritz.router = new Worker(\'/routes.js\');')):'';return h('html',null,h('head',null,h('title',null,'Aliens app!'),h('link',{rel:'stylesheet',href:'/styles.css'}),h('meta',{name:'viewport',content:'width=device-width, initial-scale=1'})),h('body',null,h('header',null),h('main',null,h('section',null,b)),h('footer',null,h('p',null,'Content courtesy of the ',h('a',{href:'http://avp.wikia.com/wiki/Main_Page'},'Xenopedia'),', and licensed under the ',h('a',{href:'http://www.wikia.com/Licensing'},'CC-BY-SA'),'.')),d))};

var Loading = function(){return h("div",{"class":"loading"},h("svg",{version:"1.1",id:"Layer_1",xmlns:"http://www.w3.org/2000/svg",x:"0px",y:"0px",width:"24px",height:"30px",viewBox:"0 0 24 30",style:"enable-background:new 0 0 50 50;"},h("rect",{x:"0",y:"0",width:"4",height:"10",fill:"#333",transform:"translate(0 17.7778)"},h("animateTransform",{attributeType:"xml",attributeName:"transform",type:"translate",values:"0 0; 0 20; 0 0",begin:"0",dur:"0.6s",repeatCount:"indefinite"})),h("rect",{x:"10",y:"0",width:"4",height:"10",fill:"#333",transform:"translate(0 4.44444)"},h("animateTransform",{attributeType:"xml",attributeName:"transform",type:"translate",values:"0 0; 0 20; 0 0",begin:"0.2s",dur:"0.6s",repeatCount:"indefinite"})),h("rect",{x:"20",y:"0",width:"4",height:"10",fill:"#333",transform:"translate(0 8.88889)"},h("animateTransform",{attributeType:"xml",attributeName:"transform",type:"translate",values:"0 0; 0 20; 0 0",begin:"0.4s",dur:"0.6s",repeatCount:"indefinite"}))))};

var articleRoute = function(){const a=this;a.get('/article/:id',function(b,c,d){a.state.articleData&&(b.articleData=a.state.articleData,delete a.state.articleData),d();},function(b,c,d){b.articleData||c.push(h(Layout$1,null,h(Loading,null))),d();},function(c,d,e){c.articleData?e():article(c.params.id).then(f=>{c.articleData=f,e();},e);},function(b,c){let d=b.articleData,e=d.article.sections[0];c.push(h(Layout$1,null,h('h1',null,e.title),h('article',null,e.content.map(f=>{return h('p',null,f.text)}))));});};

const app=fritz();app.configure(indexRoute).configure(articleRoute);

}());
