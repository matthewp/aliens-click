'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var Messenger=class{constructor(a){this.router=a,this._listen();}_listen(){self.addEventListener('message',a=>this.handle(a));}handle(a){let b=a.data;switch(b.type){case'initial':this.router.baseURI=b.baseURI;var d={method:'GET',url:b.url};b.state&&(this.router.state=b.state),this.router.dispatch(d);break;case'request':this.router.dispatch(b);}}send(a){postMessage({tree:a});}};
var index$1=Array.isArray||function(a){return'[object Array]'==Object.prototype.toString.call(a)};
var isarray=index$1;
var index$1$1=pathToRegexp;
var parse_1=parse;
var compile_1=compile;
var tokensToFunction_1=tokensToFunction;
var tokensToRegExp_1=tokensToRegExp;
var PATH_REGEXP=new RegExp(['(\\\\.)','([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?|(\\*))'].join('|'),'g');function parse(a,b){for(var p,d=[],f=0,g=0,k='',l=b&&b.delimiter||'/';null!=(p=PATH_REGEXP.exec(a));){var q=p[0],r=p[1],t=p.index;if(k+=a.slice(g,t),g=t+q.length,r){k+=r[1];continue}var u=a[g],v=p[2],w=p[3],x=p[4],y=p[5],z=p[6],A=p[7];k&&(d.push(k),k='');var B=p[2]||l,C=x||y;d.push({name:w||f++,prefix:v||'',delimiter:B,optional:'?'===z||'*'===z,repeat:'+'===z||'*'===z,partial:null!=v&&null!=u&&u!==v,asterisk:!!A,pattern:C?escapeGroup(C):A?'.*':'[^'+escapeString(B)+']+?'});}return g<a.length&&(k+=a.substr(g)),k&&d.push(k),d}function compile(a,b){return tokensToFunction(parse(a,b))}function encodeURIComponentPretty(a){return encodeURI(a).replace(/[\/?#]/g,function(b){return'%'+b.charCodeAt(0).toString(16).toUpperCase()})}function encodeAsterisk(a){return encodeURI(a).replace(/[?#]/g,function(b){return'%'+b.charCodeAt(0).toString(16).toUpperCase()})}function tokensToFunction(a){var b=Array(a.length);for(var d=0;d<a.length;d++)'object'==typeof a[d]&&(b[d]=new RegExp('^(?:'+a[d].pattern+')$'));return function(f,g){var k='',l=f||{},p=(g||{}).pretty?encodeURIComponentPretty:encodeURIComponent;for(var q=0;q<a.length;q++){var r=a[q];if('string'==typeof r){k+=r;continue}var u,t=l[r.name];if(null==t)if(r.optional){r.partial&&(k+=r.prefix);continue}else throw new TypeError('Expected "'+r.name+'" to be defined');if(isarray(t)){if(!r.repeat)throw new TypeError('Expected "'+r.name+'" to not repeat, but received `'+JSON.stringify(t)+'`');if(0===t.length)if(r.optional)continue;else throw new TypeError('Expected "'+r.name+'" to not be empty');for(var v=0;v<t.length;v++){if(u=p(t[v]),!b[q].test(u))throw new TypeError('Expected all "'+r.name+'" to match "'+r.pattern+'", but received `'+JSON.stringify(u)+'`');k+=(0===v?r.prefix:r.delimiter)+u;}continue}if(u=r.asterisk?encodeAsterisk(t):p(t),!b[q].test(u))throw new TypeError('Expected "'+r.name+'" to match "'+r.pattern+'", but received "'+u+'"');k+=r.prefix+u;}return k}}function escapeString(a){return a.replace(/([.+*?=^!:${}()[\]|\/\\])/g,'\\$1')}function escapeGroup(a){return a.replace(/([=!:$\/()])/g,'\\$1')}function attachKeys(a,b){return a.keys=b,a}function flags(a){return a.sensitive?'':'i'}function regexpToRegexp(a,b){var d=a.source.match(/\((?!\?)/g);if(d)for(var f=0;f<d.length;f++)b.push({name:f,prefix:null,delimiter:null,optional:!1,repeat:!1,partial:!1,asterisk:!1,pattern:null});return attachKeys(a,b)}function arrayToRegexp(a,b,d){var f=[];for(var g=0;g<a.length;g++)f.push(pathToRegexp(a[g],b,d).source);var k=new RegExp('(?:'+f.join('|')+')',flags(d));return attachKeys(k,b)}function stringToRegexp(a,b,d){return tokensToRegExp(parse(a,d),b,d)}function tokensToRegExp(a,b,d){isarray(b)||(d=b||d,b=[]),d=d||{};var f=d.strict,g=!1!==d.end,k='';for(var l=0;l<a.length;l++){var p=a[l];if('string'==typeof p)k+=escapeString(p);else{var q=escapeString(p.prefix),r='(?:'+p.pattern+')';b.push(p),p.repeat&&(r+='(?:'+q+r+')*'),r=p.optional?p.partial?q+'('+r+')?':'(?:'+q+'('+r+'))?':q+'('+r+')',k+=r;}}var t=escapeString(d.delimiter||'/'),u=k.slice(-t.length)===t;return f||(k=(u?k.slice(0,-t.length):k)+'(?:'+t+'(?=$))?'),k+=g?'$':f&&u?'':'(?='+t+'|$)',attachKeys(new RegExp('^'+k,flags(d)),b)}function pathToRegexp(a,b,d){return isarray(b)||(d=b||d,b=[]),d=d||{},a instanceof RegExp?regexpToRegexp(a,b):isarray(a)?arrayToRegexp(a,b,d):stringToRegexp(a,b,d)}index$1$1.parse=parse_1,index$1$1.compile=compile_1,index$1$1.tokensToFunction=tokensToFunction_1,index$1$1.tokensToRegExp=tokensToRegExp_1;function decodeURLEncodedURIComponent(a){return'string'==typeof a?decodeURIComponent(a.replace(/\+/g,' ')):a}class Route{constructor(a,b){b=b||{},this.path='*'===a?'(.*)':a,this.method=b.method===void 0?'GET':b.method,this.regexp=index$1$1(this.path,this.keys=[]);}isMatch(a,b){if(this.method!==a)return!1;var d=b.indexOf('?'),f=~d?b.slice(0,d):b,g=this.regexp.exec(decodeURIComponent(f));return g}match(a,b,d){let f=this.isMatch(a,b);if(!f)return!1;var g=this.keys;for(var k=1,l=f.length;k<l;++k){var p=g[k-1],q=decodeURLEncodedURIComponent(f[k]);q===void 0&&hasOwnProperty.call(d,p.name)||(d[p.name]=q);}return!0}middleware(a){return(b,d,f)=>{return this.match(b.method,b.url.pathname,b.params)?a(b,d,f):void f()}}}var Response=class{constructor(a,b){this.request=a,this.app=b,this.messenger=b.messenger,this.isEnded=!1;}redirect(a){this.app.dispatch({method:'GET',url:a});}push(a){'html'===a[0][1]&&a.shift(),'html'===a[a.length-1][1]&&a.pop(),this.messenger.send(a);}end(a){this.isEnded||(this.push(a),this.isEnded=!0);}};class App{static get app(){return this._val}static set app(a){this._app=a;}static hasMatchingRoute(a,b){return this._app.hasMatchingRoute(a,b)}constructor(){this.messenger=new Messenger(this),this.baseURI='/',this.routes=[],this.callbacks=[],this.state={},App.app=this;}dispatch(a){function b(){let l=k.callbacks[g++];l&&l(a,f,b);}let d=a.url=new URL(a.url,this.currentURL);this.currentURL=d,a.params={};let f=new Response(a,this),g=0,k=this;b();}hasMatchingRoute(a,b){for(var d=0,f=this.routes.length;d<f;d++)if(this.routes[d].isMatch(a,b))return!0;return!1}_addRoute(a,b,d){if(d.length){var f=new Route(b,{method:a});for(var g=0;g<d.length;++g)this.callbacks.push(f.middleware(d[g]));this.routes.push(f);}}configure(a){return a.call(this),this}use(a,...b){return this._addRoute(null,a||'*',b),this}get(a,...b){this._addRoute('GET',a,b);}post(a,...b){this._addRoute('POST',a,b);}put(a,...b){this._addRoute('PUT',a,b);}delete(a,...b){this._addRoute('DELETE',a,b);}}const isNode='object'==typeof process&&'[object process]'==={}.toString.call(process);function signal(a,b,d,f){switch(b){case'action':if('form'===a){let g=s.event(f)||'submit',k=s.method(f)||f.method;return[1,'on'+g,d,k]}break;case'href':if('a'===a&&App.hasMatchingRoute('GET',d))return[1,'onclick',d,'GET'];break;case'data-url':if(App.hasMatchingRoute('GET',d)){let g=s.event(f)||'click';return[1,'on'+g,d,'GET']}}}const s=['event','url','method'].reduce(function(a,b){return a[b]=function(d){return d['data-'+b]},a},{});var signal$1=isNode?function(){}:signal;class Tree extends Array{}var h=function(a,b,d){const f=arguments.length;if(2===f?('object'!=typeof b||Array.isArray(b))&&(d=b,b=null):(3<f||d instanceof Tree||'string'==typeof d)&&(d=Array.prototype.slice.call(arguments,2)),'function'==typeof a)return a(b||{},d);var g=new Tree;if(b){var k;b=Object.keys(b).reduce(function(p,q){var r=b[q];p.push(q),p.push(r);var t=signal$1(a,q,r,b);return t&&(!k&&(k=[]),k.push(t)),p},[]);}var l=[1,a];return b&&l.push(b),k&&l.push(k),g.push(l),d&&d.forEach(function(p){if('string'==typeof p)return void g.push([4,p]);for(;p&&p.length;)g.push(p.shift());}),g.push([2,a]),g};

const isNode$1='object'==typeof process&&'[object process]'==={}.toString.call(process);var Layout = function(a,b){let c=a.state;const d=isNode$1?h('div',null,h('script',{src:'/node_modules/fritz/window.js'}),h('script',null,c?`fritz.state = ${JSON.stringify(c)};\n`:'','fritz.router = new Worker(\'/routes.js\');'),h('script',{src:'/service-worker-registration.js'})):'';return h('html',null,h('head',null,h('title',null,'Aliens app!'),h('link',{rel:'stylesheet',href:'/styles.css'}),h('link',{rel:'manifest',href:'/manifest.json'}),h('meta',{name:'viewport',content:'width=device-width, initial-scale=1'}),h('link',{rel:'preload',href:'/node_modules/fritz/window.js',as:'script'}),h('link',{rel:'preload',href:'/routes.js',as:'worker'}),h('link',{rel:'preload',href:'/service-worker-registration.js',as:'script'}),h('link',{rel:'shortcut icon',href:'/favicon.ico'})),h('body',null,h('header',null,h('a',{'class':'home-button',href:'/'},h('svg',{'class':'home-icon',version:'1.0',xmlns:'http://www.w3.org/2000/svg',viewBox:'0 0 300.000000 300.000000',preserveAspectRatio:'xMidYMid meet'},h('g',{transform:'translate(0.000000,300.000000) scale(0.100000,-0.100000)',fill:'#210124',stroke:'none'},h('path',{'class':'node',id:'node1',d:'M1419 2846 c-69 -55 -1374 -1367 -1398 -1406 -11 -19 -21 -45 -21 -58 0 -35 41 -91 78 -103 72 -24 54 -40 760 664 l662 662 663 -662 c707 -707 689 -691 759 -664 33 13 78 71 78 102 0 13 -9 39 -21 58 -22 36 -1359 1379 -1412 1418 -46 34 -94 31 -148 -11z'}),h('path',{'class':'node',id:'node2',d:'M923 1784 l-573 -574 0 -393 c1 -293 4 -401 14 -428 20 -56 61 -103 113 -129 46 -24 57 -25 297 -28 195 -3 250 -1 256 9 5 7 9 182 10 388 0 229 5 392 11 416 29 109 138 242 240 292 59 29 153 53 209 53 167 0 339 -110 416 -266 45 -91 54 -173 54 -519 -1 -143 0 -286 0 -318 l0 -59 253 4 252 3 55 31 c38 22 64 46 85 79 l30 48 3 409 3 408 -574 575 c-316 316 -576 575 -578 574 -2 0 -262 -259 -576 -575z'})),h('g',{transform:'translate(0.000000,300.000000) scale(0.100000,-0.100000)',fill:'#ADADAD',stroke:'none'})))),h('main',null,h('section',null,b)),h('footer',null,h('p',null,'Content courtesy of the ',h('a',{href:'http://avp.wikia.com/wiki/Main_Page'},'Xenopedia'),', and licensed under the ',h('a',{href:'http://www.wikia.com/Licensing'},'CC-BY-SA'),'.')),d))};

var Loading = function(){return h("div",{"class":"loading"},h("svg",{version:"1.1",id:"Layer_1",xmlns:"http://www.w3.org/2000/svg",x:"0px",y:"0px",width:"24px",height:"30px",viewBox:"0 0 24 30",style:"enable-background:new 0 0 50 50;"},h("rect",{x:"0",y:"0",width:"4",height:"10",fill:"#E5FCF5",transform:"translate(0 17.7778)"},h("animateTransform",{attributeType:"xml",attributeName:"transform",type:"translate",values:"0 0; 0 20; 0 0",begin:"0",dur:"0.6s",repeatCount:"indefinite"})),h("rect",{x:"10",y:"0",width:"4",height:"10",fill:"#E5FCF5",transform:"translate(0 4.44444)"},h("animateTransform",{attributeType:"xml",attributeName:"transform",type:"translate",values:"0 0; 0 20; 0 0",begin:"0.2s",dur:"0.6s",repeatCount:"indefinite"})),h("rect",{x:"20",y:"0",width:"4",height:"10",fill:"#E5FCF5",transform:"translate(0 8.88889)"},h("animateTransform",{attributeType:"xml",attributeName:"transform",type:"translate",values:"0 0; 0 20; 0 0",begin:"0.4s",dur:"0.6s",repeatCount:"indefinite"}))))};

function first(a){let b=Object.keys(a)[0];return a[b]}function thumbnail(a){let b=a.thumbnail||'';return b=b.replace('http:',''),b}

function Specie({specie:a}){let b=`/article/${a.id}`,c=thumbnail(a);return h('li',{'class':'specie'},h('a',{href:b},h('figure',null,c?h('img',{src:c}):''),h('span',{'class':'specie-title'},a.title)))}var SpeciesList = function({filter:a,species:b}){let c=a?filterSpecies(b,a):b;return h('div',null,h('h1',null,'Aliens'),h('form',{action:'/search','data-event':'keyup','data-no-push':!0},h('input',{type:'text',value:a?a:'',name:'q',placeholder:'Search species','class':'alien-search'})),h('ul',{'class':'species'},c.map(d=>{return h(Specie,{specie:d})})))};function filterSpecies(a,b){return b=b.toLowerCase(),a.filter(c=>-1!==c.title.toLowerCase().indexOf(b))}

function article$1({data:a}){let b=a.article.sections[0],c=first(a.detail.items);return h('div',{'class':'species-article'},h('header',null,h('h1',null,b.title)),h('article',null,h('figure',null,h('img',{src:thumbnail(c)})),h('div',null,a.article.sections.map(articleSection$1))))}function articleSection$1(a,b){return h('section',null,0===b?'':h('h2',null,a.title),h('div',null,a.content.map(c=>{switch(c.type){case'list':return list(c);default:return h('p',null,c.text);}})))}function list(a){return h('ul',null,a.elements.map(b=>{return h('li',null,b.text)}))}

function index(a,b){return h(Layout,{state:b},h(SpeciesList,{species:a}))}function search(a,b,c){return h(Layout,{state:c},h(SpeciesList,{species:a,filter:b}))}function article(a,b){return h(Layout,{state:b},h(article$1,{data:a}))}

exports.Layout = Layout;
exports.Loading = Loading;
exports.SpeciesList = SpeciesList;
exports.index = index;
exports.search = search;
exports.article = article;
